---
title: "My title"
author: "Yiliu Cao"
thanks: "Code and data from this analysis are available at: https://github.com/yiliuc/Bicycle_Thefts_2023.git"
date: "today"
date-format: "long"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| message: false
#| echo: false

#### Workspace set-up ####

## Load packages
library(tidyverse)
library(palmerpenguins)
library(here)
library(kableExtra)

# read in the cleaned data
# setwd("/Users/caoyiliu/Desktop/U of T/Year 4/STA497/Bicycle_Thefts_2023")
cleaned_data <- read_csv(here("outputs/data/cleaned_data.csv"))
raw_data <- read_csv(here("inputs/data/raw_bicycle_thefts_data.csv"))
```


# Introduction

As the annual ranking by PeopleForBikes on 2022, Toronto has been named the 16th best major cycling city. In Toronto, there is about 300 kilometers on-street bike lanes and over 150 kilometers of off-street bike trails. Bicycle is becoming the main travel mode for the people living in Toronto. You can see people taking bicycle around each corner. However, as the number of bicycles increases each year, bicycles thefts had became a severe problem that needs to pay more attention on this. In Toronto, the bicycle thefts in Toronto surged during the past summer, nearly a 429 per cent increases. According to the neighborhood crime app by TPS, the downtown Toronto is place where the bicycle theft is mostly likely to occur, especially the U of T campus where the bicycle thefts is maximum. 

Once the the bike is stolen, then the probability of getting it back is very low. However, even though the people lock their bikes, it may still be stolen as breaking the lock on the bicycle is a easy thing. You can even break the U lock with only a pen. Therefore, it is necessary for the bicycle riders to learn the feature influencing the possibility of bicycle to be stolen and estimate how likely their bicycle will be stolen. In this paper, I will use the historical bicycle thefts in Toronto to investigate the factors contributing to the bicycle thefts and tell the riders in what circumstances, the bicycle is most likely to be stolen.

In this paper, there will be four main parts: Data, Results, Discussion and Conclusion. In the Data section, I will introduce the data used in this paper and summarize the key variables. In addition to that, I will use the figures to show what kind of bicycles are most likely to be stolen as well as the places in the Results session. Moreover, in the Discussion session, I will emphasize the main findings and discuss how avoid the bicycle thefts. Finally, I will discuss the limitations and further conclude the entire paper in the Conclusion session.


# Data {#sec-data}
The data will be used in this paper was obtained from Open Data Toronto Portal by the library `opendatatoronto`. The name of the data file is `Bicycle Thefts`. The data contains above 30,000 rows and about 30 columns. The raw data was cleaned using the open source statistical programming language with packages 1, 2, 3. In the cleaned data, it contains 11 variables which can be divided into three main categories.

## The Time of Bicycle Thefts Occurrence
The cleaned data contains very detailed information regarding the occurrence time of each theft. The smallest unit is the occurrence hour of each theft. The table below shows the summary table for the occurrence of bicycle thefts

```{r}
cleaned_data %>% 
  group_by(occ_year) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  rename(`Occurrence Year` = occ_year,
         `Count` = n) %>% 
  kable()
```


## The Places Where the Bike was stolen
The second main category in the cleaned data is describing the places of bicycle thefts. There are six main premises type of bicycle thefts, which are: Commercial, Apartment, Other, House, Educational, Transit and Other. The premises type here represent the places where the bicycle was stolen.

```{r}
cleaned_data %>% 
  group_by(premises_type) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  rename(`Premise Type` = premises_type,
         `Count` = n) %>% 
  kable()
```


## The Stolen Bicycles' Own Features
The last category of variables in the cleaned data is the features of each stolen bicycle. The features of each stolen bike include its brand, type, color and cost.

```{r}
cleaned_data %>% 
  group_by(bike_type) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  rename(`Bike Type` = bike_type,
         `Count` = n) %>% 
  kable()
```

```{r}
cleaned_data %>% 
  group_by(bike_colour) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n)) %>% 
  rename(`Bike Colour` = bike_colour,
         `Count` = n) %>% 
  kable()
```


# Results

## There was a rebounace of bicycle thefts in 2022, especially for summer.
```{r, echo = FALSE}
# Ensure the cleaned_data dataframe has columns named 'Year', 'Month', and 'Bicycle_Thefts' or equivalent

# Summarize data by Year and Month
summarized_data <- cleaned_data %>%
  filter(occ_year %in% 2017:2022) %>%  # Filtering data for the years 2014 to 2022
  group_by(occ_year, occ_month) %>%
  summarize(Total_Thefts = n())  # Replace 'Bicycle_Thefts' with the correct column name if different

# Plot the data
summarized_data %>% 
    mutate(occ_month = factor(occ_month, levels = month.name)) %>% 
    ggplot(aes(x = occ_month, y = Total_Thefts, group = occ_year, color =  as.factor(occ_year))) +
    geom_line(size = 1) +
    scale_colour_manual(name = "Years", 
                      values = c("grey", "black", "green", "red", "blue","skyblue")) +
    labs(title = "The number of bicycle thefts from 2017 to 2022 by month",
       x = "Month",
       y = "Number of bicycle thefts") +
    theme_minimal() +
    guides(x = guide_axis(angle = 90))
```

Descriptions here

## Increasing number of bicycle thefts on the outside and educational areas.
```{r}
cleaned_data <- cleaned_data %>% 
  mutate(stolen_summer = case_when(occ_month %in% c("May", "June", "July", "August") ~ "Yes",
                                   TRUE ~ "No"))
cleaned_data |>
  filter(occ_year >= 2020 & premises_type != "Other") %>% 
  ggplot(mapping = aes(x = premises_type, fill=stolen_summer)) +
  geom_bar() +
  theme_minimal() +
  labs(
    x = "Premises type",
    y = "Number of thefts",
    fill = "Stolen during summer?") +
  facet_wrap(vars(occ_year)) +
  guides(x = guide_axis(angle = 90)) +
  theme(legend.position = "bottom")
```

Descriptions here

## Three

```{r}
mean_price <- mean(cleaned_data$bike_cost, na.rm = TRUE)
top_colors <- cleaned_data %>%
  count(bike_colour) %>%
  arrange(desc(n)) %>%
  slice(1:4) %>%
  pull(bike_colour)
top_bike_types <- cleaned_data %>%
  count(bike_type) %>%
  arrange(desc(n)) %>%
  slice(1:6) %>%
  pull(bike_type)

cleaned_data <- cleaned_data %>%
  mutate(above_mean = ifelse(bike_cost > mean_price, "Above Mean", "Below Mean"))

cleaned_data %>%
  filter(bike_colour %in% top_colors, bike_type %in% top_bike_types) %>%
  mutate(bike_colour_new = case_when(bike_colour == "BLK" ~ "Black",
                                     bike_colour == "BLU" ~ "Blue",
                                     bike_colour == "GRY" ~ "Grey",
                                     bike_colour == "WHI" ~ "White")) %>% 
  ggplot(mapping = aes(x = bike_type, fill = above_mean)) +
  geom_bar() +
  theme_minimal() +
  labs(x = "Bicycle Type",
       y = "Number of Bicycle Thefts",
       fill = "Price of Stolen Bicycles") +
  facet_wrap(vars(bike_colour_new),
             scales = "free") +
  scale_fill_manual(values = c("Above Mean" = "#E69F00", "Below Mean" = "#204e4c")) +
  guides(x = guide_axis(angle = 90)) +
  theme(legend.position = "bottom")
```

Descriptions here


# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

# Conclusion

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage


\newpage


# References


